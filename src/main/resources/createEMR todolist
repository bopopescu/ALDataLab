#When creating new EMR cluster :
EMRMASTER="ec2-54-209-81-97.compute-1.amazonaws.com"
ALDATALABDIR="/Users/guillaumepinot/Dev/Alstom/V2/script/spark/IdeaProjects/ALDataLab"

ssh -i ~/Dev/AWS/Credentials/KeyLezoomerUs.pem hadoop@$EMRMASTER "if [[ ! -d script ]]; then mkdir script;fi;if [[ ! -d lib ]]; then mkdir lib;fi"
scp -i ~/Dev/AWS/Credentials/KeyLezoomerUs.pem $ALDATALABDIR/target/scala-2.10/ALDataLab-assembly-1.1.jar hadoop@$EMRMASTER:~/lib
scp -i ~/Dev/AWS/Credentials/KeyLezoomerUs.pem ALDATALABDIR/client/script/ALDataLab-client.sh hadoop@$EMRMASTER:~/script
scp -i ~/Dev/AWS/Credentials/KeyLezoomerUs.pem ALDATALABDIR/client/script/distributeByBatch.sh hadoop@$EMRMASTER:~/script
ssh -i ~/Dev/AWS/Credentials/KeyLezoomerUs.pem hadoop@$EMRMASTER "chmod +x script/*.sh"

#Patch /etc/zeppelin/conf/zeppelin-env.sh :
export CLASSPATH="/usr/share/aws/aws-java-sdk/*:/usr/lib/hadoop-lzo/lib/*:/usr/share/aws/emr/emrfs/conf:/usr/share/aws/emr/emrfs/lib/*:/usr/share/aws/emr/emrfs/auxlib/*"



#Add S3 notebook
export ZEPPELIN_NOTEBOOK_S3_BUCKET="gezeppelin"
export ZEPPELIN_NOTEBOOK_S3_USER="zeppelin"

#zeppelin-site.xml :
<property>
  <name>zeppelin.notebook.s3.user</name>
  <value>zeppelin</value>
  <description>user name for s3 folder structure</description>
</property>

<property>
  <name>zeppelin.notebook.s3.bucket</name>
  <value>gezeppelin</value>
  <description>bucket name for notebook storage</description>
</property>

<property>
  <name>zeppelin.notebook.storage</name>
  <value>org.apache.zeppelin.notebook.repo.S3NotebookRepo</value>
  <description>notebook persistence layer implementation</description>
</property>

<!--
<property>
  <name>zeppelin.notebook.storage</name>
  <value>org.apache.zeppelin.notebook.repo.VFSNotebookRepo</value>
  <description>notebook persistence layer implementation</description>
</property>
-->

#Add following line in /etc/spark/conf/spark-defaults.conf
spark.dynamicAllocation.enabled true

Add rluta public key in .ssh/Authorized




#ec2 spark cluster
cd /Users/guillaumepinot/Dev/Alstom/V2/script/spark/IdeaProjects/ALDataLab/infra/ec2
./spark-ec2 -k KeyLezoomerUs -i ~/.ssh/KeyLezoomerUs.pem --pipeline-version=1.3.1 -s 17 launch zeppelin
./spark-ec2 --key-pair=KeyLezoomerUs --identity-file=/Users/guillaumepinot/Dev/AWS/Credentials/KeyLezoomerUs.pem --region=us-east-1 --zone=us-east-1a --spot-price=0.045 --instance-type=m3.xlarge --copy-aws-credentials -s 3 --master-instance-type=m3.xlarge launch gespark



#zeppelin ssl
cd $HOME/zeppelin; mkdir keystore

8aE+Q9z/
name=zeppelin.gealstom.eu
openssl req -new -x509 -subj /CN=$name -newkey rsa:1024 -days 365 -nodes -keyout /certs/$name.key -out /certs/$name.crt
openssl pkcs12 -export -in $name.crt -inkey $name.key -out keystore.p12 -name $name

keytool -importkeystore -deststorepass -destkeystore server.jks -srckeystore keystore.p12 -srcstoretype PKCS12 -srcstorepass motDePasse -alias $name

vi /root/zeppelin/conf/zeppelin-site.xml



